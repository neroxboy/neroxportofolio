{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.multiCaching = multiCaching;\nconst eventemitter3_1 = __importDefault(require(\"eventemitter3\"));\nconst caching_js_1 = require(\"./caching.js\");\nconst utils_js_1 = require(\"./utils.js\");\n/**\n * Module that lets you specify a hierarchy of caches.\n */\nfunction multiCaching(caches) {\n  const eventEmitter = new eventemitter3_1.default();\n  for (const cache of caches) {\n    cache.on('error', event => eventEmitter.emit('error', event));\n  }\n  const get = async key => {\n    for (const cache of caches) {\n      try {\n        // eslint-disable-next-line no-await-in-loop\n        const value = await cache.get(key);\n        if (value !== undefined) {\n          return value;\n        }\n      } catch (error) {\n        const errorEvent = {\n          error,\n          key,\n          operation: 'get'\n        };\n        eventEmitter.emit('error', errorEvent);\n      }\n    }\n  };\n  const set = async (key, data, ttl, slice = caches.length) => {\n    await Promise.all(caches.slice(0, slice).map(async cache => cache.set(key, data, ttl))).catch(error => {\n      const errorEvent = {\n        error,\n        key,\n        operation: 'set',\n        data\n      };\n      eventEmitter.emit('error', errorEvent);\n    });\n  };\n  return {\n    get,\n    async set(key, value, ttl) {\n      await set(key, value, ttl);\n    },\n    async del(key) {\n      await Promise.all(caches.map(async cache => cache.del(key))).catch(error => {\n        const errorEvent = {\n          error,\n          key,\n          operation: 'del'\n        };\n        eventEmitter.emit('error', errorEvent);\n      });\n    },\n    // eslint-disable-next-line max-params\n    async wrap(key, function_, ttl, refreshThreshold, options = {}) {\n      const options_ = {\n        ...caching_js_1.defaultWrapOptions,\n        ...options\n      };\n      let value;\n      let i = 0;\n      for (; i < caches.length; i++) {\n        try {\n          // eslint-disable-next-line no-await-in-loop\n          value = await caches[i].get(key);\n          if (value !== undefined) {\n            break;\n          }\n        } catch (error) {\n          const errorEvent = {\n            error,\n            key,\n            operation: 'get'\n          };\n          eventEmitter.emit('error', errorEvent);\n        }\n      }\n      if (value === undefined) {\n        const result = await function_();\n        const cacheTtl = typeof ttl === 'function' ? ttl(result) : ttl;\n        await (0, utils_js_1.conditionalAwait)(async () => set(key, result, cacheTtl), !options_.nonBlockingSet);\n        return result;\n      }\n      const cacheTtl = typeof ttl === 'function' ? ttl(value) : ttl;\n      await (0, utils_js_1.conditionalAwait)(async () => set(key, value, cacheTtl, i).then(async () => caches[i].wrap(key, function_, ttl, refreshThreshold)), !options_.nonBlockingSet);\n      return value;\n    },\n    async reset() {\n      await Promise.all(caches.map(async x => x.reset())).catch(error => {\n        const errorEvent = {\n          error,\n          key: '',\n          operation: 'reset'\n        };\n        eventEmitter.emit('error', errorEvent);\n      });\n    },\n    async mget(...keys) {\n      const values = Array.from({\n        length: keys.length\n      }).fill(undefined);\n      for (const cache of caches) {\n        if (values.every(x => x !== undefined)) {\n          break;\n        }\n        try {\n          // eslint-disable-next-line no-await-in-loop\n          const value = await cache.store.mget(...keys);\n          for (const [i, v] of value.entries()) {\n            if (values[i] === undefined && v !== undefined) {\n              values[i] = v;\n            }\n          }\n        } catch (error) {\n          const errorEvent = {\n            error,\n            keys,\n            operation: 'mget'\n          };\n          eventEmitter.emit('error', errorEvent);\n        }\n      }\n      return values;\n    },\n    async mset(arguments_, ttl) {\n      await Promise.all(caches.map(async cache => cache.store.mset(arguments_, ttl))).catch(error => {\n        const keys = arguments_.map(([key]) => key);\n        const data = arguments_.map(([, value]) => value);\n        const errorEvent = {\n          error,\n          keys,\n          data,\n          operation: 'mset'\n        };\n        eventEmitter.emit('error', errorEvent);\n      });\n    },\n    async mdel(...keys) {\n      await Promise.all(caches.map(async cache => cache.store.mdel(...keys))).catch(error => {\n        const errorEvent = {\n          error,\n          keys,\n          operation: 'mdel'\n        };\n        eventEmitter.emit('error', errorEvent);\n      });\n    },\n    on: (event, handler) => eventEmitter.on('error', handler),\n    removeListener: (event, handler) => eventEmitter.removeListener(event, handler)\n  };\n}","map":{"version":3,"names":["__importDefault","mod","__esModule","Object","defineProperty","exports","value","multiCaching","eventemitter3_1","require","caching_js_1","utils_js_1","caches","eventEmitter","default","cache","on","event","emit","get","key","undefined","error","errorEvent","operation","set","data","ttl","slice","length","Promise","all","map","catch","del","wrap","function_","refreshThreshold","options","options_","defaultWrapOptions","i","result","cacheTtl","conditionalAwait","nonBlockingSet","then","reset","x","mget","keys","values","Array","from","fill","every","store","v","entries","mset","arguments_","mdel","handler","removeListener"],"sources":["C:/Users/vanitas/node_modules/cache-manager/dist/multi-caching.js"],"sourcesContent":["\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.multiCaching = multiCaching;\nconst eventemitter3_1 = __importDefault(require(\"eventemitter3\"));\nconst caching_js_1 = require(\"./caching.js\");\nconst utils_js_1 = require(\"./utils.js\");\n/**\n * Module that lets you specify a hierarchy of caches.\n */\nfunction multiCaching(caches) {\n    const eventEmitter = new eventemitter3_1.default();\n    for (const cache of caches) {\n        cache.on('error', event => eventEmitter.emit('error', event));\n    }\n    const get = async (key) => {\n        for (const cache of caches) {\n            try {\n                // eslint-disable-next-line no-await-in-loop\n                const value = await cache.get(key);\n                if (value !== undefined) {\n                    return value;\n                }\n            }\n            catch (error) {\n                const errorEvent = { error, key, operation: 'get' };\n                eventEmitter.emit('error', errorEvent);\n            }\n        }\n    };\n    const set = async (key, data, ttl, slice = caches.length) => {\n        await Promise.all(caches.slice(0, slice).map(async (cache) => cache.set(key, data, ttl))).catch(error => {\n            const errorEvent = {\n                error, key, operation: 'set', data,\n            };\n            eventEmitter.emit('error', errorEvent);\n        });\n    };\n    return {\n        get,\n        async set(key, value, ttl) {\n            await set(key, value, ttl);\n        },\n        async del(key) {\n            await Promise.all(caches.map(async (cache) => cache.del(key))).catch(error => {\n                const errorEvent = { error, key, operation: 'del' };\n                eventEmitter.emit('error', errorEvent);\n            });\n        },\n        // eslint-disable-next-line max-params\n        async wrap(key, function_, ttl, refreshThreshold, options = {}) {\n            const options_ = { ...caching_js_1.defaultWrapOptions, ...options };\n            let value;\n            let i = 0;\n            for (; i < caches.length; i++) {\n                try {\n                    // eslint-disable-next-line no-await-in-loop\n                    value = await caches[i].get(key);\n                    if (value !== undefined) {\n                        break;\n                    }\n                }\n                catch (error) {\n                    const errorEvent = { error, key, operation: 'get' };\n                    eventEmitter.emit('error', errorEvent);\n                }\n            }\n            if (value === undefined) {\n                const result = await function_();\n                const cacheTtl = typeof ttl === 'function' ? ttl(result) : ttl;\n                await (0, utils_js_1.conditionalAwait)(async () => set(key, result, cacheTtl), !options_.nonBlockingSet);\n                return result;\n            }\n            const cacheTtl = typeof ttl === 'function' ? ttl(value) : ttl;\n            await (0, utils_js_1.conditionalAwait)(async () => set(key, value, cacheTtl, i).then(async () => caches[i].wrap(key, function_, ttl, refreshThreshold)), !options_.nonBlockingSet);\n            return value;\n        },\n        async reset() {\n            await Promise.all(caches.map(async (x) => x.reset())).catch(error => {\n                const errorEvent = { error, key: '', operation: 'reset' };\n                eventEmitter.emit('error', errorEvent);\n            });\n        },\n        async mget(...keys) {\n            const values = Array.from({ length: keys.length }).fill(undefined);\n            for (const cache of caches) {\n                if (values.every(x => x !== undefined)) {\n                    break;\n                }\n                try {\n                    // eslint-disable-next-line no-await-in-loop\n                    const value = await cache.store.mget(...keys);\n                    for (const [i, v] of value.entries()) {\n                        if (values[i] === undefined && v !== undefined) {\n                            values[i] = v;\n                        }\n                    }\n                }\n                catch (error) {\n                    const errorEvent = { error, keys, operation: 'mget' };\n                    eventEmitter.emit('error', errorEvent);\n                }\n            }\n            return values;\n        },\n        async mset(arguments_, ttl) {\n            await Promise.all(caches.map(async (cache) => cache.store.mset(arguments_, ttl))).catch(error => {\n                const keys = arguments_.map(([key]) => key);\n                const data = arguments_.map(([, value]) => value);\n                const errorEvent = {\n                    error, keys, data, operation: 'mset',\n                };\n                eventEmitter.emit('error', errorEvent);\n            });\n        },\n        async mdel(...keys) {\n            await Promise.all(caches.map(async (cache) => cache.store.mdel(...keys)))\n                .catch(error => {\n                const errorEvent = { error, keys, operation: 'mdel' };\n                eventEmitter.emit('error', errorEvent);\n            });\n        },\n        on: (event, handler) => eventEmitter.on('error', handler),\n        removeListener: (event, handler) => eventEmitter.removeListener(event, handler),\n    };\n}\n//# sourceMappingURL=multi-caching.js.map"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}